schema: '2.0'
stages:
  loadvoc-fi:
    cmd: annif loadvoc ykl-omikuji-parabel-fi corpora/ykl-classes.tsv
    deps:
    - path: corpora/ykl-classes.tsv
      md5: b2f29070ccedefda72994b8db324e371
      size: 187637
    - path: venv-installed
      md5: c5a0f860381968fb21a3086f9b48068a
      size: 42
    outs:
    - path: data/vocabs/ykl-fi
      md5: 018083fe7ff2a658bb21414472563674.dir
      size: 766171
      nfiles: 3
  train-omikuji-parabel-fi:
    cmd: annif train ykl-omikuji-parabel-fi -j 8 corpora/kirjaesittelyt2021/kvesit-ykl-fin-train.tsv
    deps:
    - path: corpora/kirjaesittelyt2021/kvesit-ykl-fin-train.tsv
      md5: 39070df2de1ed470ef21dca2d0a5554d
      size: 44106743
    - path: data/vocabs/ykl-fi
      md5: 018083fe7ff2a658bb21414472563674.dir
      size: 766171
      nfiles: 3
    - path: venv-installed
      md5: c5a0f860381968fb21a3086f9b48068a
      size: 42
    params:
      projects.toml:
        ykl-omikuji-parabel-fi:
          name: YKL Omikuji Parabel Finnish
          language: fi
          backend: omikuji
          analyzer: voikko(fi)
          vocab: ykl-fi
          ngram: 1
          min_df: 1
    outs:
    - path: data/projects/ykl-omikuji-parabel-fi
      md5: 3671fc994a65d65c4e6325c1a392da38.dir
      size: 138255989
      nfiles: 6
  eval-omikuji-parabel-fi:
    cmd: annif eval ykl-omikuji-parabel-fi -j 8 -m Precision@1 -m NDCG --metrics-file
      reports/test-omikuji-parabel-fi.json corpora/kirjaesittelyt2021/kvesit-ykl-fin-test.tsv
    deps:
    - path: corpora/kirjaesittelyt2021/kvesit-ykl-fin-test.tsv
      md5: 9c26fd86d43db53bedef1c0a38f08fc8
      size: 3708388
    - path: data/projects/ykl-omikuji-parabel-fi
      md5: 3671fc994a65d65c4e6325c1a392da38.dir
      size: 138255989
      nfiles: 6
    - path: venv-installed
      md5: c5a0f860381968fb21a3086f9b48068a
      size: 42
    outs:
    - path: reports/test-omikuji-parabel-fi.json
      md5: 0bd88e36adb0aa0b295db072bf77b71a
      size: 100
  install:
    cmd: python3 -m venv venv && . venv/bin/activate && pip install -U pip wheel setuptools
      && pip install -r requirements.txt && cp requirements.txt venv-installed
    deps:
    - path: requirements.txt
      md5: c5a0f860381968fb21a3086f9b48068a
      size: 42
    outs:
    - path: venv-installed
      md5: c5a0f860381968fb21a3086f9b48068a
      size: 42
  train-omikuji-bonsai-fi:
    cmd: annif train ykl-omikuji-bonsai-fi -j 8 corpora/kirjaesittelyt2021/kvesit-ykl-fin-train.tsv
    deps:
    - path: corpora/kirjaesittelyt2021/kvesit-ykl-fin-train.tsv
      md5: 39070df2de1ed470ef21dca2d0a5554d
      size: 44106743
    - path: data/vocabs/ykl-fi
      md5: 018083fe7ff2a658bb21414472563674.dir
      size: 766171
      nfiles: 3
    - path: venv-installed
      md5: c5a0f860381968fb21a3086f9b48068a
      size: 42
    params:
      projects.toml:
        ykl-omikuji-bonsai-fi:
          name: YKL Omikuji Bonsai Finnish
          language: fi
          backend: omikuji
          cluster_balanced: 'False'
          cluster_k: 100
          max_depth: 3
          analyzer: voikko(fi)
          vocab: ykl-fi
          ngram: 1
          min_df: 1
    outs:
    - path: data/projects/ykl-omikuji-bonsai-fi
      md5: 3435c76ef9e8981eb61de97e98d2ec4a.dir
      size: 133243555
      nfiles: 6
  eval-omikuji-bonsai-fi:
    cmd: annif eval ykl-omikuji-bonsai-fi -j 8 -m Precision@1 -m NDCG --metrics-file
      reports/test-omikuji-bonsai-fi.json corpora/kirjaesittelyt2021/kvesit-ykl-fin-test.tsv
    deps:
    - path: corpora/kirjaesittelyt2021/kvesit-ykl-fin-test.tsv
      md5: 9c26fd86d43db53bedef1c0a38f08fc8
      size: 3708388
    - path: data/projects/ykl-omikuji-bonsai-fi
      md5: 3435c76ef9e8981eb61de97e98d2ec4a.dir
      size: 133243555
      nfiles: 6
    - path: venv-installed
      md5: c5a0f860381968fb21a3086f9b48068a
      size: 42
    outs:
    - path: reports/test-omikuji-bonsai-fi.json
      md5: 375156fa6065464a31c4f840d13f6991
      size: 100
  train-ykl-fasttext-fi:
    cmd: annif train ykl-fasttext-fi corpora/kirjaesittelyt2021/kvesit-ykl-fin-train.tsv
    deps:
    - path: corpora/kirjaesittelyt2021/kvesit-ykl-fin-train.tsv
      md5: 39070df2de1ed470ef21dca2d0a5554d
      size: 44106743
    - path: data/vocabs/ykl-fi
      md5: 018083fe7ff2a658bb21414472563674.dir
      size: 766171
      nfiles: 3
    - path: venv-installed
      md5: c5a0f860381968fb21a3086f9b48068a
      size: 42
    params:
      projects.toml:
        ykl-fasttext-fi:
          name: YKL fastText Finnish
          language: fi
          backend: fasttext
          analyzer: voikko(fi)
          dim: 430
          lr: 0.74
          epoch: 75
          minn: 4
          maxn: 7
          minCount: 3
          loss: hs
          limit: 1000
          chunksize: 24
          vocab: ykl-fi
    outs:
    - path: data/projects/ykl-fasttext-fi
      md5: 0bff12c6765f00fd34d6a043fdfc1a64.dir
      size: 3598553339
      nfiles: 2
